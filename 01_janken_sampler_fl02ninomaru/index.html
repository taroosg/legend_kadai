<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/css/line-awesome.min.css">
    <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script defer src=https://cdn.JsDelivr.net/npm/p5></script>
    <script defer src=https://cdn.JsDelivr.net/npm/p5/lib/addons/p5.dom.min.js></script>
    <script defer src=https://cdn.JsDelivr.net/npm/p5/lib/addons/p5.sound.min.js></script>

    <script defer src="animation.js"></script>
    <script defer src=sketch.js></script>
   
    
</head>
<body>
    <div class="gui">
        <h1 class="wf-nicomoji">ã˜ã‚ƒã‚“ã‘ã‚“ã‚µãƒ³ãƒ—ãƒ©ãƒ¼</h1>
        <div class="fadeIn-out buruburu"><i id="thumbs_up" class="la la-thumbs-up"></i></div>
        <div class="contents">
            <div id="pc">ç›¸æ‰‹ã®æ‰‹</div>
            <div id="result">çµæœ</div>
                <ul class="my-btn-list">
                    <li><i id="par" class="la la-hand-paper"></i></li>
                    <li><i id="gu"  class="la la-hand-rock"></i></li>
                    <li><i id="cho" class="la la-hand-scissors"></i></li>
                </ul>
        </div>
    </div>
    
    <script>

        // å¤‰æ•°ã¨ã‹é–¢æ•°ã®æº–å‚™-----------------------------------------
        
        let btnPress = false;
        let gu = false;
        let cho = false;
        let par = false;
        let count = 0; //è©¦åˆå›æ•°ã‚«ã‚¦ãƒ³ãƒˆã€ã‚­ãƒ¼ãƒ—ãƒ¬ã‚¹æ™‚
        let result = ""; //è©¦åˆçµæœã€éŸ³ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ†å²ã§ä½¿ã†
        let resultAll;
        let pcSelect = 0; // gu:0  cho:1  par:2

        //å‹ã¡ã‚«ã‚¦ãƒ³ãƒˆ
        let guWin = 0; 
        let choWin = 0;
        let parWin = 0;
        let win = 0;
        let lose = 0;
        // let even = 0;
        const special = 4; //ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚’å‡ºã™å‹åˆ©å›æ•°

        // pcã®æ‰‹
        const min = 0; 
        const max = 2; // ããƒ¼ãƒãƒ§ã‚­ã±ãƒ¼ã®ï¼“ç¨®
        let pcNum = function(){
          return Math.floor(Math.random() * (max - min + 1) + min);
          // 0:gu  1:cho  2:par
        }

        // è©¦åˆåˆ¤å®šã‚’ã—ã¦çµæœã‚’è¿”ã™
        let judgement = function(_mySelect){

            //è‡ªåˆ†ãŒæŠ¼ã—ãŸã‚­ãƒ¼ã®æƒ…å ±å–å¾—
            let mySelect = _mySelect; 

            //ä¹±æ•°ã§ç›¸æ‰‹ã®æ‰‹ã‚’æ±ºã‚ã‚‹
            
            // let pcSelect = pcNum(); // 0:gu  1:cho  2:par
            console.log(mySelect, pcSelect);
            
            //å‹ã¡è² ã‘åˆ¤å®š è¨˜éŒ²ã—ã¦å‹ã¡è² ã‘ã®å€¤ã‚’è¿”ã™
            if(mySelect === 0){               // ããƒ¼ã®ã¨ã
                if(pcSelect === 0){
                    return "even";
                }else if(pcSelect === 1){
                    guWin++;
                    win++;
                    //console.log('ããƒ¼å‹ã¡: ' + guWin);
                    return "win";
                }else{
                    lose++;
                    return "lose";
                }
            } else if(mySelect === 1){        // ã¡ã‚‡ãã®ã¨ã
                if(pcSelect === 0){
                    lose++;
                    return "lose";
                }else if(pcSelect === 1){
                    return "even";
                }else{
                    choWin++;
                    win++;
                    //console.log('ã¡ã‚‡ãå‹ã¡: ' + choWin);
                    return "win";
                    
                }
            } else if(mySelect === 2){        // ã±ãƒ¼ã®ã¨ã
                if(pcSelect === 0){
                    parWin++;
                    win++;
                    //console.log('ã±ãƒ¼å‹ã¡: ' + parWin);
                    return "win";           
                }else if(pcSelect === 1){
                    lose++;
                    return "lose";
                }else{
                    return "even";
                }
            }
        }

        // å…¨è©¦åˆã®çµæœåˆ¤å®š
        let judgeAll = function(){
            if(count === 4){
                if(win === 4){
                    return "awesome";
                }else if(lose === 4){
                    return "bad";
                }else{
                    return "good";
                }
            } else{
                return null;
            }
        }

        // è©¦åˆå›æ•°ã¨å‹ã¡è² ã‘ã‚«ã‚¦ãƒ³ãƒˆã®åˆæœŸåŒ–
        let resetCount = function(){
            if(count === 4){
                count = 0;
                win = 0;
                lose = 0;
            }
        }

        // pcã®æ‰‹ã®ä¹±æ•°ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹
        let transelatePcSelect = function(pcSelect){
            a = pcSelect
            if(a === 0){
                return "âœŠ";
            }else if(a === 1){
                return "âœŒï¸";
            }else{
                return "ğŸ–";
            }
                
        }

        //ã“ã“ã¾ã§------------//



        // p5.js -------------------------------------------------------

        var sample = []; // éŸ³æºãƒ•ã‚¡ã‚¤ãƒ« 
        var loseSample = [];
        var evenSample = [];
        var specialSample = [];
        var kickSample = []; 
        var hhtSample = []; 
        var snareSample = []; 
        var clapSample = []; 
        var fxSample = [];
        var bgmSample = [];
        var animation; // animationã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

        let bgcs = [230,150,175,200,225,255]; // èƒŒæ™¯è‰²


        // éŸ³æºãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿-----------------------------

        function preload(){

            loseSample[0] = loadSound('assets/miss.wav');
            loseSample[1] = loadSound('assets/lose1.wav');

            evenSample[0] = loadSound('assets/even.wav');

            specialSample[0] = loadSound('assets/thumbsUp.wav');
            specialSample[1] = loadSound('assets/Awesome.wav');



            kickSample[0] = loadSound('assets/kick.wav');
            kickSample[1] = loadSound('assets/kick2.wav');
            kickSample[2] = loadSound('assets/snare.wav');
            kickSample[3] = loadSound('assets/clap.wav');

            hhtSample[0] = loadSound('assets/hht_close.wav');
            hhtSample[1] = loadSound('assets/hht_close2.wav');
            hhtSample[2] = loadSound('assets/hht_close3.wav');
            // hhtSample[3] = loadSound('assets/clap.wav');

            // snareSample[0] = loadSound('assets/kick.wav');
            // snareSample[1] = loadSound('assets/kick2.wav');
            // snareSample[2] = loadSound('assets/snare.wav');
            // snareSample[3] = loadSound('assets/clap.wav');

            clapSample[0] = loadSound('assets/clap.wav');
            // clapSample[1] = loadSound('assets/kick2.wav');
            // clapSample[2] = loadSound('assets/snare.wav');
            // clapSample[3] = loadSound('assets/clap.wav');

            bgmSample[0] = loadSound('assets/loop.wav');
        }

        function setup(){
            createCanvas(windowWidth, windowHeight);
            bgc = bgcs[0]; //èƒŒæ™¯åˆæœŸåŒ–
            pcSelect = pcNum();
            nextPcHand(pcSelect);
            count = 0;
        }



        // åˆ¤å®šå‡¦ç†ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ãªã© -------------------------
        function draw(){
            
            background(0, 127, 255);

            // ãƒœã‚¿ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³-------------------
            // ã‚­ãƒ¼ãŒãƒ—ãƒ¬ã‚¹ã•ã‚ŒãŸã¨ãã«æ¡ä»¶å¼å†…ãŒtrue
            // ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸã‚‰ false ã«ãªã‚‹
            $(function(){
                if(gu){
                    $('#gu').css('font-size','130px');
                } else {
                    $('#gu').css('font-size','100px');
                }

                if(cho){
                    $('#cho').css('font-size','130px');
                }else{
                    $('#cho').css('font-size','100px');
                }
                if(par){
                    $('#par').css('font-size','130px');
                }else{
                    $('#par').css('font-size','100px');
                }
            });

            // ç”»é¢ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -----------------------------------
            // animation ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä»£å…¥ã•ã‚ŒãŸã‚‰trueã«ãªã‚‹ï¼Ÿ
            if(animation){        
                //console.log('animok');                      
                animation.draw(); 
            }
            
            resetCount(); // count ãŒï¼”ã«ãªã£ãŸã‚‰ãƒªã‚»ãƒƒãƒˆ

        }


        //  ã‚­ãƒ¼ã‚’ãƒ—ãƒ¬ã‚¹ã—ãŸã¨ãã®å‡¦ç† ------------------------------
        
        function keyPressed(){
            
            // ã‚°ãƒ¼ã®å‡¦ç†
            if(key==' '){
                count++; // ã˜ã‚ƒã‚“ã‘ã‚“ã®è©¦åˆæ•°ã‚«ã‚¦ãƒ³ãƒˆ
                console.log('è©¦åˆå›æ•°ï¼š' + count);
                
                gu = true;
                
                result = judgement(0);  // å‹æ•—çµæœã‚’è¿”ã™
                resultAll = judgeAll(); // 4è©¦åˆã®çµæœã‚’è¿”ã™       
                console.log(result, resultAll);
                // 0:gu  1:cho  2:par
                // win lose even ã®æ–‡å­—åˆ—ãŒresultã«è¿”ã•ã‚Œã‚‹
                // ä»¥ä¸‹ result ã®çµæœã«ã‚ˆã£ã¦æ¡ä»¶åˆ†å²
                playKeyAudio(result, 0);
                playFxAudio(resultAll, resultAll);
                drawAnimation(result, 0, resultAll);
                showResult(result, resultAll); // å‹ã£ãŸã¨ãã®ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒãƒ¼ã‚¯è¡¨ç¤º
            }
            
            // ã¡ã‚‡ãã®å‡¦ç†
            if(key=='l'){
                count++; 
                console.log('è©¦åˆå›æ•°ï¼š' + count);

                cho = true;
                result = judgement(1);
                resultAll = judgeAll();
                playKeyAudio(result, 1);  // 1: cho
                playFxAudio(resultAll);
                drawAnimation(result, 1,resultAll);
                showResult(result, resultAll); 
                bgc = bgcs[2];
                btnPress = true;  
                //console.log(btnPress);
            }

            // ãƒ‘ãƒ¼ã®å‡¦ç†
            if(key=='d'){
                count++;
                console.log('è©¦åˆå›æ•°ï¼š' + count);
                par = true;
                btnPress = true;  
                bgc = bgcs[3];
                result = judgement(2);
                resultAll = judgeAll();
                playKeyAudio(result, 2);  // 2: par
                playFxAudio(resultAll);
                drawAnimation(result, 2, resultAll);
                showResult(result, resultAll); 
                //console.log('par:' + par + ', btnPress:' + btnPress);
            }

            // ????
            if(key=='k'){
                bgc = bgcs[4];
                btnPress = true;  
                console.log(btnPress);
            }

        }

        
        // æŠ¼ã—ãŸã‚­ãƒ¼ã‚’é›¢ã—ãŸã‚‰------------------------------

        function keyReleased(){

            if(key ==' '){
                btnPress = false;
                gu = false;
                // 4å›å‹ã£ãŸã‚‰ãƒªã‚»ãƒƒãƒˆå‹ã¡ã‚«ã‚¦ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ
                if(guWin === special){ 
                    guWin = 0;
                }
                pcSelect = pcNum();    //pcSelectæ›´æ–°
                nextPcHand(pcSelect);  //pcã®æ¬¡ã®æ‰‹ã‚’ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
                //console.log('æ¬¡ã®æ‰‹: ' + pcSelect);
            }

            if(key=='l'){
                btnPress = false;
                cho = false;
                if(choWin === special){ 
                    choWin = 0;
                }
                pcSelect = pcNum();    //pcSelectæ›´æ–°
                nextPcHand(pcSelect);  //pcã®æ¬¡ã®æ‰‹ã‚’ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
               // console.log('æ¬¡ã®æ‰‹: ' + pcSelect);
            }

            if(key=='d'){
                btnPress = false;
                par = false;
                if(parWin === special){ 
                    parWin = 0;
                }
                pcSelect = pcNum();    //pcSelectæ›´æ–°
                nextPcHand(pcSelect);  //pcã®æ¬¡ã®æ‰‹ã‚’ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
               // console.log('æ¬¡ã®æ‰‹: ' + pcSelect);
            }

        }


        // éŸ³ã‚’é³´ã‚‰ã™---------------------------------------------

        function playKeyAudio(result, mySelect){
            _result = result;
            _mySelect = mySelect;
            //console.log(_result);

            // ããƒ¼ã®ã¨ã  --------------------
            if(_mySelect === 0){
                console.log('4è©¦åˆçµæœï¼š' + judgeAll());
                if(_result === "win"){
                    // // 4å›å‹ã£ãŸã¨ã           <----  gu cho par ã®å‹åˆ©æ•°ã§å€‹åˆ¥ã®å‡¦ç†ã‚’ã—ãŸã„ã¨ã
                    // if(win === special){ 
                    //     specialSample[0].play();
                    // }
                    kickSample[0].play();
                }else if(_result === "lose"){
                    //loseéŸ³ã¯ï¼”å›ç›®ã®ã¨ãã ã‘é³´ã‚‰ã•ãªã„
                    if(count !== 4){
                        loseSample[0].play();
                        kickSample[0].play();
                    }
                }else if(_result === "even"){
                    evenSample[0].play();
                    kickSample[0].play();
                }else{
                    alert('error');
                } 

            }

            // ã¡ã‚‡ãã®ã¨ã  -------------------
            if(_mySelect === 1){
                console.log('4è©¦åˆçµæœï¼š' + judgeAll());
                if(_result === "win"){
                    hhtSample[2].play();
                }else if(_result === "lose"){
                    if(count !== 4){
                        loseSample[0].play();
                    }
                }else if(_result === "even"){
                    evenSample[0].play();
                }else{
                    alert('error');
                } 

            }
            
            // ã±ãƒ¼ã®ã¨ã  -------------------
            if(_mySelect === 2){
                console.log('4è©¦åˆçµæœï¼š' + judgeAll());
                if(_result === "win"){
                    if(win === special){ 
                        specialSample[0].play();
                    }
                    clapSample[0].play();
                }else if(_result === "lose"){
                    if(count !== 4){
                        loseSample[0].play();
                    }
                }else if(_result === "even"){
                    evenSample[0].play();
                }else{
                    alert('error');
                } 

            }
        }

        function playFxAudio(resultAll){
            //count === 4ã®ã¨ãã®è©¦åˆçµæœã«å¿œã˜ã¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆéŸ³ã‚’
            if(resultAll === "awesome"){
                //4é€£å‹ã®ã¨ã
                console.log('AWESOME');
                specialSample[1].play();
            } else if(resultAll === "bad"){
                //4é€£æ•—ã®ã¨ã
                console.log('BAD');
                loseSample[1].play();
            } else if(resultAll === "good"){
                //ãã‚Œä»¥å¤–ã®æˆ¦ç¸¾ã®ã¨ã
                console.log('GOOD');
                specialSample[0].play();
            }
        }



        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æç”»ã™ã‚‹ -------------------------------
        function drawAnimation(result, mySelect,resultAll){
            _result = result;
            _mySelect = mySelect;
            _resultAll = resultAll;

            // è¤‡æ•°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯é…åˆ—ç®¡ç†ã˜ã‚ƒãªã„ã¨ç„¡ç†ã£ã½ã„ã€‚
            // if(_resultAll === "awesome"){
            //     console.log('test');
            //     animation = new Anim_gu_special();
            // }

            // // 0:gu  1:cho  2:par 
            
            // ããƒ¼ã®ã¨ã
            if(_mySelect === 0){
                if(_result === "win"){
                   // if(win === special){
                        //console.log('specialæç”»');
                       // animation = new Anim_gu_special();
                   // }else{
                        animation = new Anim_gu_win();              
                   // }
                } else if(_result === "lose"){
                    animation = new Anim_gu_lose();
                } else {
                    animation = new Anim_even();
                }
            }
            // ã¡ã‚‡ãã®ã¨ã
            if(_mySelect === 1){
                if(_result === "win"){
                    animation = new Anim_cho_win(); 
                    console.log('chokianime');             
                } else if(_result === "lose"){
                    animation = new Anim_gu_lose();
                } else {
                    animation = new Anim_even();
                }
            }
            
            // ã±ãƒ¼ã®ã¨ã
            if(_mySelect === 2){
                if(_result === "win"){
                    animation = new Anim_par_win();        
                    console.log('Paranime');             
                } else if(_result === "lose"){
                    animation = new Anim_gu_lose();
                } else {
                    animation = new Anim_even();
                }
            }
        }

        // å‹æ•—ã®çµæœã‚’ãƒšãƒ¼ã‚¸ä¸Šã«ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã™ã‚‹------------------
        function showResult(result, resultAll){
            _result = result;
            _resultAll = resultAll;

            // 4é€£å‹æ™‚
            if(_resultAll === "awesome"){
                showThambsUp();
            }

            if(_result === "win"){
                $('#result').text('win');
            }else if(_result === "lose"){
                $('#result').text('lose');   
            }else if(_result === "even"){
                $('#result').text('even');
            }else{
                alert('error');
            } 

        }

        // PCã®æ¬¡ã®æ‰‹ã‚’ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º --------------------------------
        function nextPcHand(pcSelect){
            _pcSelect = pcSelect;
            $('#pc').text(transelatePcSelect(_pcSelect)); 
            // æ•°å€¤ç®¡ç†ã—ã¦ã„ãŸæ‰‹ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹   
        }
 
        // å‹ã£ãŸã¨ãã€ã‚µãƒ ã‚ºã‚¢ãƒƒãƒ—ãƒãƒ¼ã‚¯ã‚’è¡¨ç¤º
        function showThambsUp(){
            $('#thumbs_up').css('opacity', '1');
            setTimeout(function(){
                $('#thumbs_up').css('opacity', '0');
            },700);
        }
        
        //CANVASã®ãƒªã‚µã‚¤ã‚º-------------------------------------------
    
        function windowResized(){
            resizeCanvas(windowWidth, windowHeight);
        }


    </script>
</body>
</html>